<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Viewer</title>
</head>
<body style="background:black;color:lime;">
<canvas id="screen" style="width:100%;"></canvas>

<div id="status-ws" style="color: yellow;">WS: connecting...</div>
<div id="status-stream" style="color: cyan;">STREAM: idle</div>

<script>
//const ws = new WebSocket("ws://localhost:8080");  // CAMBIAR si es remoto
const ws = new WebSocket("wss://render-websocket-screen-share.onrender.com");   
ws.binaryType = "arraybuffer";

const canvas = document.getElementById("screen");
const ctx = canvas.getContext("2d", { alpha: false });

ws.onmessage = async (event) => {
  const ab = event.data;                      // ArrayBuffer directo
  const blob = new Blob([ab], { type: "image/webp" });

  // createImageBitmap es rÃ¡pido y nativo
  const img = await createImageBitmap(blob);

  canvas.width = img.width;
  canvas.height = img.height;

  ctx.drawImage(img, 0, 0);
};

  ws.onopen = () => {
  document.getElementById("status-ws").textContent = "WS: connected";
  document.getElementById("status-ws").style.color = "lime";
};

ws.onerror = () => {
  document.getElementById("status-ws").textContent = "WS: error";
  document.getElementById("status-ws").style.color = "red";
};

ws.onclose = () => {
  document.getElementById("status-ws").textContent = "WS: disconnected";
  document.getElementById("status-ws").style.color = "orange";
  notifyStopped() 
};

function notifyStreaming() {
  document.getElementById("status-stream").textContent = "STREAM: sending frames...";
  document.getElementById("status-stream").style.color = "lime";
}

function notifyStopped() {
  document.getElementById("status-stream").textContent = "STREAM: stopped";
  document.getElementById("status-stream").style.color = "red";
}
</script>
</body>
</html>

